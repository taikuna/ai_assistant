# AI秘書 - 要件定義書

## 概要

LINEグループ内で動作するAIアシスタント。お客様からのレタッチ・画像加工依頼を受け付け、業務を効率化する。

## 業務内容

**レタッチ・画像加工** の受注管理

## 技術スタック

| 項目 | 選定 |
|------|------|
| AIモデル | Gemini 2.5 Flash |
| プラットフォーム | LINE Messaging API（グループチャット） |
| ホスティング | AWS（Lambda + API Gateway） |
| ストレージ | Google Drive（お客様別ドライブ → 日付別フォルダ） |
| カレンダー連携 | Googleカレンダー |
| 社内通知 | Slack（納期リマインド用） |
| 画像形式 | 全形式対応（JPG, PNG, PSD, AI, TIFF, etc.） |

---

## 主要機能

### 1. 依頼受付・管理

- [ ] お客様からの依頼メッセージを認識
- [ ] 依頼内容を構造化して保存
- [ ] 納期の設定・管理

### 2. データ受け取り・検証

- [ ] お客様から送られたURLを検出
- [ ] URLの有効性チェック（アクセスできるか）
- [ ] URLが無効な場合「URLが間違っています」と通知
- [ ] 画像ファイルの存在・形式を確認
- [ ] 画像が正しく取得できるか検証

### 3. Google Drive連携

- [ ] 有効なURLから画像をダウンロード
- [ ] お客様別ドライブの日付別フォルダに自動アップロード
- [ ] アップロード完了をLINEに通知

### 4. AIによる情報確認・ヒアリング

AIが自動で不足情報を判断し、必要に応じて質問する。

**確認が必要な項目：**

| 項目 | 条件 | 質問例 |
|------|------|--------|
| 納期 | 明示されていない場合 | 「ご希望の納品日を教えてください」 |
| 背景色 | 切り抜き依頼の場合 | 「背景色は何色にしますか？（赤系、青系など大まかでOK）」 |
| レタッチ内容 | 詳細が不明な場合 | 「どのような加工をご希望ですか？」 |

- [ ] 依頼内容をAIが解析
- [ ] 不足情報を自動判定
- [ ] 必要な質問を自動生成
- [ ] 回答を受けて情報を更新
- [ ] 「これで合っていますか？」の最終確認

### 5. カレンダー連携

- [ ] 納期をGoogleカレンダーに自動登録
- [ ] 案件名・お客様名を含めて登録

### 6. Slack通知（社内向け）

- [ ] 納期前のリマインド通知をSlackに送信
- [ ] 新規依頼の通知（TODO: 要検討）

---

## 依頼パターン（実例）

### パターン1: 基本的な依頼
```
お客様: 「レタッチお願いします」
        [URL]

AI秘書: 「ご依頼ありがとうございます。
        URLを確認しました。画像を保存しています...
        ご希望の納品日を教えてください。」
```

### パターン2: 切り抜き依頼
```
お客様: 「切り抜きお願いします」
        [URL]

AI秘書: 「ご依頼ありがとうございます。
        切り抜きですね。背景色は何色にしますか？
        （赤系、青系など大まかでOKです）」
```

### パターン3: 急ぎの依頼
```
お客様: 「急ぎでレタッチお願いします！」
        [URL]

AI秘書: 「急ぎのご依頼、承知しました。
        具体的な納品希望日時を教えてください。」
```

### パターン4: URLエラー
```
お客様: 「レタッチお願いします」
        [無効なURL]

AI秘書: 「申し訳ありません。URLにアクセスできませんでした。
        URLをご確認いただけますか？」
```

---

## 依頼フロー

```
1. お客様がLINEで依頼メッセージ + URL送信
          ↓
2. AI秘書がURLを検出・検証
          ↓
   ├─ URLが無効 → 「URLが間違っています」と通知 → 終了（再送待ち）
   │
   └─ URLが有効 → 画像をダウンロード
          ↓
3. お客様別ドライブの日付別フォルダに保存
          ↓
4. AIが依頼内容を解析
          ↓
   ├─ 情報不足あり → 質問（納期、背景色など）→ 回答待ち → ループ
   │
   └─ 情報十分 → 次へ
          ↓
5. 最終確認「これで合っていますか？」
          ↓
6. お客様が確認 →「OK」
          ↓
7. Googleカレンダーに納期登録
          ↓
8. 「依頼を受け付けました」と完了通知
          ↓
9. 納期前にSlackでリマインド通知
```

---

## 検討事項・質問

### 決定済み

1. ~~カレンダー~~: Googleカレンダー → **決定**
2. ~~依頼の種類~~: レタッチ・画像加工 → **決定**
3. ~~Google Driveのフォルダ構成~~: お客様別ドライブ → 日付別フォルダ → **決定**
4. ~~リマインド通知~~: Slackに送信 → **決定**
5. ~~画像形式~~: 全形式対応 → **決定**

### 未決定

1. **データ保存**: 依頼データ（メタ情報）はどこに保存する？
   - DynamoDB（AWS）
   - スプレッドシート（手軽、一覧で見やすい）
   - その他

2. **権限**: グループ内の誰でも依頼できる？特定の人だけ？

3. **Slackリマインドのタイミング**: 納期の何日前？何時間前？

4. **お客様の識別方法**: LINEの表示名で判別？事前登録制？

---

## システム構成

```
┌─────────────┐     ┌─────────────────────────────────────┐
│    LINE     │     │              AWS                    │
│  グループ   │     │  ┌─────────────┐  ┌─────────────┐  │
│             │────▶│  │ API Gateway │─▶│   Lambda    │  │
│             │◀────│  └─────────────┘  │  (AI秘書)   │  │
└─────────────┘     │                   └──────┬──────┘  │
                    └──────────────────────────┼─────────┘
                                               │
                         ┌─────────────────────┼─────────────────────┐
                         │                     │                     │
                         ▼                     ▼                     ▼
              ┌─────────────────┐   ┌─────────────────┐   ┌─────────────────┐
              │ Gemini 2.5 Flash│   │  Google Drive   │   │     Slack       │
              │   (AI処理)      │   │  (ファイル保存) │   │  (社内通知)     │
              └─────────────────┘   └─────────────────┘   └─────────────────┘
                                               │
                                               ▼
                                    ┌─────────────────┐
                                    │ Google Calendar │
                                    │   (納期管理)    │
                                    └─────────────────┘
```

---

## メモ・アイデア

（ここに思いついたことを追記していく）

