# AI秘書 - 要件定義書

## 概要

LINEグループ内で動作する**汎用AIアシスタント**。設定ファイルをカスタマイズすることで、様々な業種の受注管理に対応。

**初期ユースケース**: レタッチ・画像加工の受注管理

## サービス方針

- まず自分で使用（レタッチ業務）
- 将来的に汎用サービスとして展開
- 設定ファイル + プロンプトで業種ごとにカスタマイズ可能

---

## 汎用化設計

### 2段階のAI活用

```
【セットアップフェーズ】
事業者 ←→ AI秘書「何の業種ですか？どんな依頼が来ますか？」
              ↓
         設定ファイル自動生成

【運用フェーズ】
お客様 ←→ AI秘書（設定に基づいて対応）
```

### オンボーディング（AIによる設定作成）

AIが事業者にヒアリングして、設定ファイルを自動生成する。

```
AI秘書: 「AI秘書のセットアップを始めます。
        まず、どんなお仕事をされていますか？」

事業者: 「レタッチ・画像加工です」

AI秘書: 「画像加工ですね。お客様からの依頼で、
        必ず確認が必要な情報は何ですか？
        （例：納期、サイズ、色など）」

事業者: 「納期と、切り抜きの時は背景色」

AI秘書: 「了解です。他に依頼の種類はありますか？
        （例：レタッチ、切り抜き、色補正など）」

事業者: 「レタッチ、切り抜き、合成です」

AI秘書: 「設定が完了しました！
        ・業種: 画像加工
        ・確認項目: 納期、背景色（切り抜き時）
        ・サービス: レタッチ、切り抜き、合成
        これでよろしいですか？」
```

### 設定ファイル構造（案）

```yaml
# 事業者情報
business:
  name: "〇〇レタッチ"
  type: "画像加工"

# 提供サービス
services:
  - "レタッチ"
  - "切り抜き"
  - "合成"
  - "色補正"

# AIが確認すべき項目
required_fields:
  - name: "納期"
    ask_if: "not_specified"  # 指定がない場合は必ず聞く
    question: "ご希望の納品日を教えてください"

  - name: "背景色"
    ask_if: "service_is:切り抜き"  # 切り抜きの時だけ聞く
    question: "背景色は何色にしますか？（赤系、青系など大まかでOK）"

  - name: "合成内容"
    ask_if: "service_is:合成"
    question: "どのような合成をご希望ですか？"

# 連携設定
integrations:
  google_drive:
    enabled: true
    folder_structure: "client/date"  # お客様別 → 日付別

  google_calendar:
    enabled: true

  slack:
    enabled: true
    reminder_at: "deadline"  # 納期日時にリマインド

  dynamodb:
    enabled: true
    table_name: "ai_secretary_orders"
```

### 汎用化による他業種対応例

| 業種 | 確認項目 |
|------|----------|
| レタッチ | 納期、背景色（切り抜き時） |
| 翻訳 | 言語ペア、納期、分量 |
| デザイン | サイズ、用途、納期 |
| 印刷 | 部数、用紙、納期 |
| 動画編集 | 尺、納期、BGM有無 |

---

## 技術スタック

| 項目 | 選定 |
|------|------|
| AIモデル | Gemini 2.5 Flash |
| プラットフォーム | LINE Messaging API（グループチャット） |
| ホスティング | AWS（Lambda + API Gateway） |
| ファイル保存 | Google Drive（お客様別ドライブ → 日付別フォルダ） |
| データ保存 | DynamoDB（依頼履歴・メタ情報） |
| カレンダー連携 | Googleカレンダー |
| 社内通知 | Slack（納期日時にリマインド） |
| 画像形式 | 全形式対応（JPG, PNG, PSD, AI, TIFF, etc.） |

---

## 主要機能

### 1. 依頼受付・管理

- [ ] お客様からの依頼メッセージを認識
- [ ] 依頼内容を構造化して保存
- [ ] 納期の設定・管理

### 2. データ受け取り・検証

- [ ] お客様から送られたURLを検出
- [ ] URLの有効性チェック（アクセスできるか）
- [ ] URLが無効な場合「URLが間違っています」と通知
- [ ] 画像ファイルの存在・形式を確認
- [ ] 画像が正しく取得できるか検証

### 3. Google Drive連携

- [ ] 有効なURLから画像をダウンロード
- [ ] お客様別ドライブの日付別フォルダに自動アップロード
- [ ] アップロード完了をLINEに通知

### 4. AIによる情報確認・ヒアリング

AIが自動で不足情報を判断し、必要に応じて質問する。

**確認が必要な項目：**

| 項目 | 条件 | 質問例 |
|------|------|--------|
| 納期 | 明示されていない場合 | 「ご希望の納品日を教えてください」 |
| 背景色 | 切り抜き依頼の場合 | 「背景色は何色にしますか？（赤系、青系など大まかでOK）」 |
| レタッチ内容 | 詳細が不明な場合 | 「どのような加工をご希望ですか？」 |

- [ ] 依頼内容をAIが解析
- [ ] 不足情報を自動判定
- [ ] 必要な質問を自動生成
- [ ] 回答を受けて情報を更新
- [ ] 「これで合っていますか？」の最終確認

### 5. カレンダー連携

- [ ] 納期をGoogleカレンダーに自動登録
- [ ] 案件名・お客様名を含めて登録

### 6. Slack通知（社内向け）

- [ ] 納期日時にリマインド通知をSlackに送信
  - 例: 納期が「12月5日 15:00」なら、その日時にSlackへ通知
- [ ] 新規依頼の通知（TODO: 要検討）

### 7. DynamoDB連携

- [ ] 依頼データをDynamoDBに自動保存
- [ ] 保存項目: お客様名、依頼内容、納期、ステータス、Drive URL など
- [ ] 会話の状態管理（ヒアリング中、確認待ち、完了など）

---

## 依頼パターン（実例）

### パターン1: 基本的な依頼
```
お客様: 「レタッチお願いします」
        [URL]

AI秘書: 「ご依頼ありがとうございます。
        URLを確認しました。画像を保存しています...
        ご希望の納品日を教えてください。」
```

### パターン2: 切り抜き依頼
```
お客様: 「切り抜きお願いします」
        [URL]

AI秘書: 「ご依頼ありがとうございます。
        切り抜きですね。背景色は何色にしますか？
        （赤系、青系など大まかでOKです）」
```

### パターン3: 急ぎの依頼
```
お客様: 「急ぎでレタッチお願いします！」
        [URL]

AI秘書: 「急ぎのご依頼、承知しました。
        具体的な納品希望日時を教えてください。」
```

### パターン4: URLエラー
```
お客様: 「レタッチお願いします」
        [無効なURL]

AI秘書: 「申し訳ありません。URLにアクセスできませんでした。
        URLをご確認いただけますか？」
```

---

## 依頼フロー

```
1. お客様がLINEで依頼メッセージ + URL送信
          ↓
2. AI秘書がURLを検出・検証
          ↓
   ├─ URLが無効 → 「URLが間違っています」と通知 → 終了（再送待ち）
   │
   └─ URLが有効 → 画像をダウンロード
          ↓
3. お客様別ドライブの日付別フォルダに保存
          ↓
4. AIが依頼内容を解析
          ↓
   ├─ 情報不足あり → 質問（納期、背景色など）→ 回答待ち → ループ
   │
   └─ 情報十分 → 次へ
          ↓
5. 最終確認「これで合っていますか？」
          ↓
6. お客様が確認 →「OK」
          ↓
7. Googleカレンダーに納期登録
          ↓
8. 「依頼を受け付けました」と完了通知
          ↓
9. 納期前にSlackでリマインド通知
```

---

## 検討事項・質問

### 全項目決定済み

1. ~~カレンダー~~: Googleカレンダー → **決定**
2. ~~依頼の種類~~: レタッチ・画像加工 → **決定**
3. ~~Google Driveのフォルダ構成~~: お客様別ドライブ → 日付別フォルダ → **決定**
4. ~~リマインド通知~~: Slackに送信 → **決定**
5. ~~画像形式~~: 全形式対応 → **決定**
6. ~~データ保存~~: DynamoDB → **決定**
7. ~~Slackリマインドのタイミング~~: 納期日時に通知 → **決定**
8. ~~権限~~: グループ内の誰でも依頼可能 → **決定**
9. ~~お客様の識別方法~~: LINEの表示名で判別（後ろに会社名が入っている）→ **決定**
   - 例: 「田中太郎 - Yojigen LLC」→ 会社名「Yojigen LLC」で識別

---

## システム構成

```
┌─────────────┐     ┌───────────────────────────────────────────────────┐
│    LINE     │     │                     AWS                           │
│  グループ   │     │  ┌─────────────┐  ┌─────────────┐  ┌───────────┐ │
│             │────▶│  │ API Gateway │─▶│   Lambda    │─▶│ DynamoDB  │ │
│             │◀────│  └─────────────┘  │  (AI秘書)   │  │(データ保存)│ │
└─────────────┘     │                   └──────┬──────┘  └───────────┘ │
                    └──────────────────────────┼───────────────────────┘
                                               │
                    ┌──────────────────────────┼──────────────────────────┐
                    │                          │                          │
                    ▼                          ▼                          ▼
         ┌─────────────────┐        ┌─────────────────┐        ┌─────────────────┐
         │ Gemini 2.5 Flash│        │  Google Drive   │        │     Slack       │
         │   (AI処理)      │        │  (ファイル保存) │        │  (社内通知)     │
         └─────────────────┘        └─────────────────┘        └─────────────────┘
                                               │
                                               ▼
                                    ┌─────────────────┐
                                    │ Google Calendar │
                                    │   (納期管理)    │
                                    └─────────────────┘
```

---

## メモ・アイデア

（ここに思いついたことを追記していく）

